<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1E88E5">
    <meta name="description" content="Practice Swedish conversations with AI">
    
    <title>APPEN - Swedish Practice</title>
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <link rel="manifest" href="manifest.json">
    
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
</head>
<body>
<header class="header">
        <div class="header-content container">
            <h1 style="margin-left: var(--spacing-md);">SV-Appen</h1>
            <nav class="main-nav">
                <button id="menu-toggle-btn" class="btn btn-icon hide-md" aria-label="Open menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                </button>
                <div id="menu-dropdown" class="menu-dropdown hide-md">
                    <div class="language-selector-container">
                        <span class="language-label">AI Explains in:</span>
                        <select id="languageSelector" class="form-select-sm language-selector" aria-label="Select translation language">
                            <option value="zh">中文</option>
                            <option value="ko">한국어</option>
                            <option value="ur">اردو</option>
                            <option value="hi">हिन्दी</option>
                            <option value="uk">Українська</option>
                            <option value="ru">Русский</option>
                            <option value="vi">Tiếng Việt</option>
                        </select>
                    </div>
                    <a href="#" id="nav-practice" class="nav-link">Practice</a>
                    <a href="#" id="nav-search" class="nav-link active">Search</a>
                    <a href="#" id="nav-wordbook" class="nav-link" style="display: none;">Wordbook</a>
                    <a href="#" id="nav-translator" class="nav-link">Translator</a>
                    <a href="#" id="nav-login" class="nav-link">Login</a>
                    <a href="#" id="nav-logout" class="nav-link" style="display: none;">Logout</a>
                </div>

                <div class="main-nav-desktop show-md">
                    <a href="#" id="nav-practice-desktop" class="nav-link">Practice</a>
                    <a href="#" id="nav-search-desktop" class="nav-link active">Search</a>
                    <a href="#" id="nav-wordbook-desktop" class="nav-link" style="display: none;">Wordbook</a>
                    <a href="#" id="nav-translator-desktop" class="nav-link">Translator</a> 
                    <a href="#" id="nav-login-desktop" class="nav-link">Login</a>
                    <a href="#" id="nav-logout-desktop" class="nav-link" style="display: none;">Logout</a>
                    <div class="language-selector-container">
                        <span class="language-label">AI Explains in:</span>
                        <select id="languageSelector-desktop" class="form-select-sm language-selector" aria-label="Select translation language">
                            <option value="zh">中文</option>
                            <option value="ko">한국어</option>
                            <option value="ur">اردو</option>
                            <option value="hi">हिन्दी</option>
                            <option value="uk">Українська</option>
                            <option value="ru">Русский</option>
                            <option value="vi">Tiếng Việt</option>
                        </select>
                    </div>
                </div>
            </nav>
            
        </div>
    </header>

    <main class="main-content" id="practice-section" style="display: none;">
        <div class="container">
            <section class="card mb-3" style="padding: var(--spacing-md);">
                <div class="level-selector-compact">
                    <button class="level-button" data-action="select-level" data-level="A1"><h3>A1</h3><p class="text-secondary">Beginner</p></button>
                    <button class="level-button active" data-action="select-level" data-level="A2"><h3>A2</h3><p class="text-secondary">Elementary</p></button>
                    <button class="level-button" data-action="select-level" data-level="B1"><h3>B1</h3><p class="text-secondary">Intermediate</p></button>
                    <button class="level-button" data-action="select-level" data-level="B2"><h3>B2</h3><p class="text-secondary">Upper-Int</p></button>
                </div>
            </section>
            <section class="card scenario-card mb-3">
                <div class="scenario-content">
                    <div id="scenarioText" class="scenario-text mb-3">Loading scenario...</div>
                    <div class="scenario-actions flex">
                        <button id="randomScenarioBtn" class="btn btn-secondary"><span>Random</span></button>
                        <button id="customScenarioBtn" class="btn btn-secondary"><span>Custom</span></button>
                    </div>
                </div>
            </section>
            <section class="card p-2 mb-3">
                 <button id="exampleDialogBtn" class="btn btn-outline btn-block"><span>View Example Dialogue</span></button>
            </section>
            <section id="chatContainer" class="chat-container"></section>
        </div>
    </main>

    <section id="search-section" class="main-content">
        <div class="container">
            <div class="card">
                <h2 class="card-header">Word Lookup</h2>
                <div class="form-group">
                    <input type="search" id="searchInput" class="form-input" placeholder="Search for a Swedish word...">
                </div>
                <div id="searchResults" class="search-results"></div>
                
                <div id="paginationControls" class="pagination-controls"></div>
                </div>
        </div>
    </section>

    <section id="wordbook-section" class="main-content" style="display: none;">
        <div class="container">
            <div class="card"><h2 class="card-header">My Wordbook</h2><div id="wordbookList" class="wordbook-list"></div></div>
        </div>
    </section>

    <section id="translator-section" class="main-content" style="display: none;">
        <div class="container">
            <div class="card">
                <h2 class="card-header">Translator</h2>
                <div class="form-group">
                    <label for="text-to-translate" class="form-label">Enter text in any language:</label>
                    <textarea id="text-to-translate" class="form-textarea" rows="5" placeholder="Type or paste text here..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Translate to Swedish as:</label>
                    <div style="display: flex; gap: 1rem;">
                        <label><input type="radio" name="translation-style" value="colloquial" checked> Informal (Spoken)</label>
                        <label><input type="radio" name="translation-style" value="formal"> Formal (Written)</label>
                    </div>
                </div>
                <button id="translate-btn" class="btn btn-primary">Translate</button>
                <div id="translator-loading-indicator" style="display: none;">
                    </div>
                <div class="mt-4">
                    <h3 style="font-size: 1.2rem;">Result:</h3>
                    <div id="translation-result" class="card" style="background: var(--background); min-height: 100px; white-space: pre-wrap;"></div>
                </div>
        </div>
    </section>
    
    <div id="login-modal" class="modal-overlay">
        <div class="modal">
            <div class="flex-between">
                <h2 id="modal-title">Login</h2>
                <button id="close-login-modal" class="btn btn-icon btn-ghost" aria-label="Close modal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="auth-form"><div id="error-message" class="alert alert-error" style="display: none;"></div><div class="form-group"><label for="username" class="form-label">Username</label><input type="text" id="username" class="form-input" required></div><div class="form-group"><label for="password" class="form-label">Password</label><input type="password" id="password" class="form-input" required></div><div class="modal-actions"><button type="button" id="auth-mode-switch" class="btn btn-ghost">Need an account? Register</button><button type="submit" id="auth-submit-btn" class="btn btn-primary">Login</button></div></form>
        </div>
    </div>
    <div id="customScenarioModal" class="modal-overlay"><div class="modal"><h2>Create Custom Scenario</h2><p>Describe a situation you'd like to practice:</p><div class="form-group"><input type="text" id="customScenarioInput" class="form-input" placeholder="e.g., ordering coffee at a café"></div><div class="modal-actions"><button id="customScenarioCancel" class="btn btn-outline">Cancel</button><button id="customScenarioGenerate" class="btn btn-primary">Generate</button></div></div></div>
    <div id="toast" class="toast"></div>

    <style>
        .main-nav { display: flex; gap: var(--spacing-md); }
        .nav-link { color: var(--text-secondary); text-decoration: none; font-weight: 500; padding: var(--spacing-xs) 0; border-bottom: 2px solid transparent; transition: all var(--transition-base); }
        .nav-link:hover { color: var(--text-primary); }
        .nav-link.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .level-selector-compact { display: flex; gap: var(--spacing-sm); justify-content: center; align-items: center; }
        .level-selector-compact .level-button { padding: var(--spacing-xs) var(--spacing-md); min-width: 60px; flex: 1; }
        .level-selector-compact .level-button h3 { font-size: var(--font-size-base); margin: 0; }
        .level-selector-compact .level-button p { display: none; }
        .app-container { height: 100vh; overflow: hidden; display: flex; flex-direction: column; padding-top: var(--safe-area-inset-top); }
        .header { background-color: var(--surface); box-shadow: var(--shadow-sm); position: sticky; top: 0; z-index: var(--z-sticky); flex-shrink: 0; }
        .header-content { display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md) 0; }
        .header h1 { font-size: var(--font-size-2xl); color: var(--primary-color); margin: 0; }
        .main-content { flex: 1; display: flex; flex-direction: column; min-height: 0; padding: var(--spacing-md) 0; overflow-y: auto;}
        .level-button { padding: var(--spacing-md); border: 2px solid var(--border-color); border-radius: var(--border-radius); background: var(--surface); cursor: pointer; transition: all var(--transition-base); text-align: center; }
        .level-button:hover { border-color: var(--primary-color); transform: translateY(-2px); }
        .level-button.active { border-color: var(--primary-color); background-color: rgba(30, 136, 229, 0.1); }
        .level-button h3 { margin: 0 0 var(--spacing-xs) 0; color: var(--text-primary); }
        .level-button p { margin: 0; font-size: var(--font-size-sm); }
        .scenario-card { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; position: relative; overflow: hidden; }
        .scenario-text { font-size: var(--font-size-base); line-height: 1.6; min-height: 60px; }
        .scenario-actions { gap: var(--spacing-sm); }
        .scenario-actions .btn { flex: 1; }
        .chat-container { display: flex; flex-direction: column; gap: var(--spacing-md); flex: 1; overflow-y: auto; padding-bottom: calc(100px + var(--safe-area-inset-bottom)); }
        .message { display: flex; gap: var(--spacing-sm); }
        .message-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: var(--font-size-sm); flex-shrink: 0; }
        .message.user .message-avatar { background-color: var(--primary-color); color: white; }
        .message.ai .message-avatar { background-color: var(--secondary-color); color: var(--text-primary); }
        .message-content { flex: 1; }
        .message-bubble { background: var(--surface); padding: var(--spacing-sm) var(--spacing-md); border-radius: 18px; box-shadow: var(--shadow-sm); display: inline-block; max-width: 100%; }
        .message.user { flex-direction: row-reverse; }
        .message.user .message-bubble { background-color: var(--primary-color); color: white; }
        .message-text { font-size: var(--font-size-base); line-height: 1.4; word-break: break-word; }
        .audio-player { width: 100%; height: 32px; outline: none; margin-top: var(--spacing-sm); }
        .recording-interface { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); box-shadow: 0 -4px 12px rgba(0,0,0,0.1); padding: var(--spacing-md); padding-bottom: calc(var(--spacing-md) + var(--safe-area-inset-bottom)); z-index: var(--z-fixed); transform: translateY(100%); transition: transform var(--transition-base) ease-out; }
        .recording-interface.active { transform: translateY(0); }
        .record-button { width: 80px; height: 80px; border-radius: 50%; background: var(--error-color); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all var(--transition-base); position: relative; box-shadow: var(--shadow-md); }
        .record-button.recording { animation: recordPulse 1.5s ease-in-out infinite; }
        @keyframes recordPulse { 0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(244, 67, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); } }
        .record-icon { width: 32px; height: 32px; background: white; border-radius: 50%; transition: border-radius var(--transition-base); }
        .record-button.recording .record-icon { border-radius: 4px; width: 24px; height: 24px; }
        .audio-visualizer { height: 40px; display: flex; align-items: center; justify-content: center; gap: 2px; margin-bottom: var(--spacing-md); }
        .audio-bar { width: 3px; background: var(--primary-color); border-radius: 2px; transition: height 0.1s; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: var(--z-modal-backdrop); opacity: 0; visibility: hidden; transition: opacity var(--transition-base), visibility var(--transition-base); padding: var(--spacing-lg); }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: var(--surface); border-radius: var(--border-radius); padding: var(--spacing-lg); max-width: 400px; width: 100%; box-shadow: var(--shadow-lg); transform: scale(0.9); transition: transform var(--transition-base); z-index: var(--z-modal); }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-actions { display: flex; gap: var(--spacing-sm); justify-content: flex-end; }
        .fab { position: fixed; bottom: calc(var(--spacing-lg) + var(--safe-area-inset-bottom)); right: var(--spacing-lg); width: 56px; height: 56px; border-radius: 50%; background: var(--primary-color); color: white; border: none; box-shadow: var(--shadow-md); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all var(--transition-base); z-index: var(--z-fixed); }
        .toast { position: fixed; bottom: calc(120px + var(--safe-area-inset-bottom)); left: 50%; transform: translateX(-50%) translateY(100px); background: #323232; color: white; padding: var(--spacing-sm) var(--spacing-lg); border-radius: var(--border-radius-pill); font-size: var(--font-size-sm); opacity: 0; transition: all var(--transition-base); z-index: var(--z-tooltip); white-space: nowrap; max-width: calc(100vw - 48px); }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        /* ADDED START: Styles for language selector label */
        .language-selector-container {
            display: flex; /* 让 label 和 select 保持一行 */
            align-items: center; /* 垂直居中 */
            gap: var(--spacing-xs); /* 间距 */
            border-left: 1px solid var(--border-color);
            padding-left: var(--spacing-md);
            margin-left: var(--spacing-sm);
        }
        .language-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            white-space: nowrap; /* 防止换行 */
        }
        /* ADDED END */

        /* ADDED START: Styles for examples and pagination */
        .result-item {
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border-color);
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-examples {
            margin-top: var(--spacing-sm);
            padding-left: var(--spacing-md);
            border-left: 3px solid var(--border-color);
        }
        .example {
            margin-bottom: var(--spacing-sm);
        }
        .example-sv {
            font-style: italic;
            color: var(--text-primary);
            margin-bottom: 0;
        }
        .example-en {
            font-style: italic;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: 0;
        }
        .pagination-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }
        .pagination-info {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        /* ADDED END */
        /* === 新增代码：为AI报告容器添加样式 === */
        .word-report-container {
            margin-top: var(--spacing-md);
            overflow: hidden; /* 用于动画 */
        }
        .word-report {
            background: var(--background);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-md);
            animation: slide-down 0.4s ease-out;
        }
        .word-report h4 {
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--primary-color);
        }
        .word-report ul {
            list-style-type: disc;
            padding-left: var(--spacing-lg);
        }
        .word-report li {
            margin-bottom: var(--spacing-xs);
        }
        .btn-get-report.active {
            background-color: var(--primary-dark);
            color: white;
        }
        /* === START: Add these styles for the new dropdown menu === */

        /* Position the nav container to anchor the dropdown */
        .main-nav {
            position: relative;
        }

        /* Style the dropdown panel */
        .menu-dropdown {
            display: none; /* Hidden by default */
            position: absolute;
            top: calc(100% + 8px); /* Position below the header */
            right: 0;
            background: var(--surface);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-sm);
            z-index: var(--z-dropdown);
            width: 200px; /* Or a width that fits your content */
            border: 1px solid var(--border-color);
        }

        /* Show the dropdown when it has the .active class */
        .menu-dropdown.active {
            display: block;
        }

        /* Style the items inside the dropdown for a vertical layout */
        .menu-dropdown .nav-link,
        .menu-dropdown .language-selector-container {
            display: flex;
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            border-left: none; /* Overriding old styles */
            margin-left: 0;
            padding-left: var(--spacing-md);
        }

        .menu-dropdown .nav-link:hover {
            background-color: var(--background);
        }

        /* Adjust the language selector for the vertical menu */
        .menu-dropdown .language-selector-container {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-md);
        }

        .menu-dropdown .language-label {
            flex-grow: 1; /* Make the label take up available space */
        }

        /* Override the active link style for the dropdown */
        .menu-dropdown .nav-link.active {
            background-color: rgba(30, 136, 229, 0.1);
            border-bottom-color: transparent; /* Remove the bottom border */
            color: var(--primary-color);
        }

        /* Style the menu button */
        #menu-toggle-btn {
            background-color: transparent;
            border: none;
            color: var(--text-secondary);
        }

        #menu-toggle-btn:hover {
            color: var(--text-primary);
            background-color: var(--background);
        }

        /* === END: New dropdown menu styles === */

    </style>
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const visualizer = document.getElementById('audioVisualizer');
            if (visualizer) {
                for (let i = 0; i < 20; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'audio-bar';
                    visualizer.appendChild(bar);
                }
            }
        });
    </script>
    <script type="module" src="js/main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(r => console.log('SW registered')).catch(e => console.log('SW reg failed'));
            });
        }
    </script>
</body>
</html>